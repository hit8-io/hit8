steps:
  - name: 'alpine:latest'
    entrypoint: 'sh'
    args:
      - '-c'
      - |
        echo "‚öôÔ∏è Installing tools..."
        # Install curl and postgres client
        apk add --no-cache curl postgresql-client

        DB_HOST="db.dxwwmmhfhsljkhftnzke.supabase.co"
        DB_PORT="5432"

        echo "---------------------------------------------------"
        echo "üîç 1. IP CHECK"
        curl -s https://api.ipify.org || echo "‚ùå Failed to get IP"
        echo ""

        echo "---------------------------------------------------"
        echo "üîç 2. DATABASE REACHABILITY CHECK (No Auth)"
        echo "Target: $$DB_HOST:$$DB_PORT"
        
        # pg_isready checks TCP reachability
        pg_isready -h "$$DB_HOST" -p "$$DB_PORT" -t 5
        
        if [ $$? -eq 0 ]; then
            echo "‚úÖ SUCCESS: Supabase is reachable from Private Pool."
        else
            echo "‚ùå FAILED: Cannot reach Supabase."
            exit 1
        fi

options:
  pool:
    name: 'projects/hit8-poc/locations/europe-west1/workerPools/private-pool-1'
