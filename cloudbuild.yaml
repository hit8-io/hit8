substitutions:
  _PROJECT_ID: 'hit8-poc'
  _VERSION: 'latest'
  _IMAGE_NAME: 'europe-west1-docker.pkg.dev/${_PROJECT_ID}/backend/api'
  _TAG: 'latest'

# Note: Substitutions can be overridden via --substitutions flag
# The workflow passes: _IMAGE_NAME, _TAG, _VERSION, _PROJECT_ID

steps:
  # ---------------------------------------------------------
  # Build Application
  # ---------------------------------------------------------
  - name: 'gcr.io/kaniko-project/executor:latest'
    id: 'build-image'
    args:
      - '--dockerfile=Dockerfile'
      - '--context=dir://./backend'
      - '--destination=${_IMAGE_NAME}:${_TAG}'
      - '--destination=${_IMAGE_NAME}:${_VERSION}'
      - '--destination=${_IMAGE_NAME}:latest'
      - '--build-arg=PRODUCTION=true'
      - '--cache=true'
